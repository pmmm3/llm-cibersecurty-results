## Overview
An attacker could get unauthenticated remote code execution on Silver Peak Unity Orchestrator by chaining 3 vulnerabilities: CVE-2020-12145, CVE-2020-12146, CVE-2020-12147.  

The attacker will use CVE-2020-12145 to get access to the APIs without authenticating by modifying the **Host** header to **localhost** or **127.0.0.1**.  

Combine with CVE-2020-12146, he will be able to delete arbitrary files, especially the file **/home/gms/gms/phantomGenImg.js**, which will be executed by PhantomJS.  

Finally, the attacker will insert the payload to the file above by using CVE-2020-12147, which affects the SQL query API. He could use the **INTO DUMPFILE** clause to write the JavaScript payload (with the module **child_process** to make the command execution) to /home/gms/gms/phantomGenImg.js. The clause INTO DUMPFILE cannot overwrite files so the attacker must exploit CVE-2020-12146 first.  

The most important part of the exploit chain is CVE-2020-12146. Therefore, this rule (detects CVE-2020-12146) is enough to block the whole chain of attack.
### Bonus for bugbounty hunters
Shodan search for Silver Peak Unity Orchestrator:  
**http.title:"Orchestrator Login"**

## Proof of Concept
```
POST /gms/rest/debugFiles/delete HTTP/1.1
Host: localhost
Content-Lenth: 35
Content-Type: application/json
Content-Length: 35

{"filename": "../phantomGenImg.js"}
```

## References
* https://medium.com/realmodelabs/silver-peak-unity-orchestrator-rce-2928d65ef749
* https://github.com/RealmodeLabs/SD-PWN/blob/master/silver_peak_unity_orchestrator_rce.py